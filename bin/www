#!/usr/bin/env node

'use strict';

var path = require('path');

var loggers = require('../logger');
loggers.configure(require('../config/logger.json'));
var logger = loggers.get('Application');

require('../tools/resource').configure({
  debug: true, logger: loggers.get('Resource'),
  defaultLocale: 'fr', folders: {
    email: { dir: path.join(__dirname, '../resource/emails') }
  }
});

var database = require('../database');
var databaseConfig = require('../config/database.json');

database.connect(databaseConfig, function(err) {
  if (err) { return logger.error(err); }
  var app = require('../app');
  var appConfig = require('../config/application.json');
  app.set('port', process.env.PORT || appConfig.port || 9000);
  var server = app.listen(app.get('port'), function() {
    logger.info('Express server listening on port ' + server.address().port);
    require('../socket.io').connect(server);
  });
});
